export const LOCALES = ['en', 'ru'] as const;
export type Locale = (typeof LOCALES)[number];

type Dict = Record<string, string>;

const STRINGS: Record<Locale, Dict> = {
  en: {
    'app.name': 'BusyaChat',
    'badge.login': 'enter gently',
    'badge.register': 'register softly',
    'auth.email': 'email',
    'auth.password': 'password',
    'auth.passwordHint': 'password (8+)',
    'auth.username': 'username',
    'auth.signIn': 'Sign in',
    'auth.signingIn': 'signing in...',
    'auth.create': 'Create account',
    'auth.creating': 'creating account...',
    'auth.switchToRegister': 'No account? Create one',
    'auth.switchToLogin': 'Have an account? Sign in',
    'layout.settings': 'settings',
    'layout.softMode': 'soft mode',
    'layout.createServerPlaceholder': 'Create new server',
    'layout.createServer': 'Create server',
    'layout.inviteCode': 'Invite code',
    'layout.join': 'Join',
    'layout.logout': 'logout',
    'servers.dmTitle': 'Direct messages',
    'channels.directs': 'Directs',
    'channels.searchUsers': 'Search users to DM',
    'channels.channels': 'Channels',
    'channels.newChannel': 'New channel name',
    'chat.searchPlaceholder': 'Search in messages',
    'chat.find': 'Find',
    'chat.joinVoice': 'Join voice',
    'chat.leaveVoice': 'Leave voice',
    'chat.results': 'Results: {{count}}',
    'chat.pickDirect': 'Pick a direct thread to start chatting.',
    'chat.pickChannel': 'Pick a channel to start chatting.',
    'chat.noMessages': 'No messages yet.',
    'chat.someoneTyping': 'Someone is typing...',
    'chat.multipleTyping': 'Multiple people are typing...',
    'chat.isTyping': '{{name}} is typing...',
    'chat.directTitle': 'Direct',
    'chat.pickChannelTitle': 'Pick a channel',
    'chat.writeMessage': 'Write a message',
    'chat.file': 'file',
    'chat.send': 'Send',
    'chat.enterHint': 'Enter to send, Shift+Enter for newline.',
    'chat.reactionPrompt': 'Reaction emoji (like ":)" or "<3")',
    'chat.editPrompt': 'Edit message',
    'members.title': 'Members',
    'members.directInfoTitle': 'Direct info',
    'members.directInfoEmpty': 'Pick a DM to see participants.',
    'settings.title': 'Server Settings',
    'settings.close': 'close',
    'settings.renameTitle': 'Rename server',
    'settings.serverName': 'Server name',
    'settings.saveName': 'Save name',
    'settings.danger': 'Danger zone',
    'settings.deleteServer': 'Delete server',
    'settings.invites': 'Invites',
    'settings.inviteMax': 'Max uses (optional)',
    'settings.inviteExpires': 'Expires at (YYYY-MM-DD)',
    'settings.createInvite': 'Create invite',
    'settings.members': 'Members',
    'settings.kick': 'kick',
    'settings.ban': 'ban',
    'settings.revoke': 'revoke',
    'settings.deleteConfirm': 'Delete this server? This cannot be undone.',
    'settings.inviteAlert': 'Invite code: {{code}}',
    'settings.unlimited': 'unlimited',
  },
  ru: {
    'app.name': 'BusyaChat',
    'badge.login': 'входим мягко',
    'badge.register': 'регистрируемся мягко',
    'auth.email': 'почта',
    'auth.password': 'пароль',
    'auth.passwordHint': 'пароль (8+)',
    'auth.username': 'ник',
    'auth.signIn': 'Войти',
    'auth.signingIn': 'входим...',
    'auth.create': 'Создать аккаунт',
    'auth.creating': 'создаём аккаунт...',
    'auth.switchToRegister': 'Нет аккаунта? Создать',
    'auth.switchToLogin': 'Уже есть аккаунт? Войти',
    'layout.settings': 'настройки',
    'layout.softMode': 'мягкий режим',
    'layout.createServerPlaceholder': 'Создать сервер',
    'layout.createServer': 'Создать сервер',
    'layout.inviteCode': 'Код инвайта',
    'layout.join': 'Войти',
    'layout.logout': 'выйти',
    'servers.dmTitle': 'Личные сообщения',
    'channels.directs': 'Личные',
    'channels.searchUsers': 'Найти пользователя для ЛС',
    'channels.channels': 'Каналы',
    'channels.newChannel': 'Имя канала',
    'chat.searchPlaceholder': 'Поиск по сообщениям',
    'chat.find': 'Найти',
    'chat.joinVoice': 'Войти в голос',
    'chat.leaveVoice': 'Выйти из голоса',
    'chat.results': 'Результатов: {{count}}',
    'chat.pickDirect': 'Выбери диалог, чтобы начать.',
    'chat.pickChannel': 'Выбери канал, чтобы начать.',
    'chat.noMessages': 'Сообщений пока нет.',
    'chat.someoneTyping': 'Кто-то печатает...',
    'chat.multipleTyping': 'Несколько человек печатают...',
    'chat.isTyping': '{{name}} печатает...',
    'chat.directTitle': 'Личные',
    'chat.pickChannelTitle': 'Выбери канал',
    'chat.writeMessage': 'Написать сообщение',
    'chat.file': 'файл',
    'chat.send': 'Отправить',
    'chat.enterHint': 'Enter — отправить, Shift+Enter — новая строка.',
    'chat.reactionPrompt': 'Эмодзи реакции (например ":)" или "<3")',
    'chat.editPrompt': 'Редактировать сообщение',
    'members.title': 'Участники',
    'members.directInfoTitle': 'Инфо',
    'members.directInfoEmpty': 'Выбери диалог, чтобы увидеть участников.',
    'settings.title': 'Настройки сервера',
    'settings.close': 'закрыть',
    'settings.renameTitle': 'Переименовать сервер',
    'settings.serverName': 'Имя сервера',
    'settings.saveName': 'Сохранить',
    'settings.danger': 'Опасная зона',
    'settings.deleteServer': 'Удалить сервер',
    'settings.invites': 'Инвайты',
    'settings.inviteMax': 'Макс. использований',
    'settings.inviteExpires': 'Истекает (ГГГГ-ММ-ДД)',
    'settings.createInvite': 'Создать инвайт',
    'settings.members': 'Участники',
    'settings.kick': 'кик',
    'settings.ban': 'бан',
    'settings.revoke': 'отозвать',
    'settings.deleteConfirm': 'Удалить сервер? Это нельзя отменить.',
    'settings.inviteAlert': 'Код инвайта: {{code}}',
    'settings.unlimited': 'без лимита',
  },
};

export function getDefaultLocale(): Locale {
  if (typeof navigator === 'undefined') return 'en';
  return navigator.language?.toLowerCase().startsWith('ru') ? 'ru' : 'en';
}

export function t(locale: Locale, key: string, vars?: Record<string, string | number>): string {
  const text = STRINGS[locale]?.[key] ?? STRINGS.en[key] ?? key;
  if (!vars) return text;
  return text.replace(/\{\{(\w+)\}\}/g, (_match, k) => String(vars[k] ?? ''));
}
