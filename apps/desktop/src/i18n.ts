export const LOCALES = ['en', 'ru'] as const;
export type Locale = (typeof LOCALES)[number];

type Dict = Record<string, string>;

const STRINGS: Record<Locale, Dict> = {
  en: {
    'app.name': 'BusyaChat',
    'badge.login': 'enter gently',
    'badge.register': 'register softly',
    'auth.email': 'email',
    'auth.password': 'password',
    'auth.passwordHint': 'password (8+)',
    'auth.username': 'username',
    'auth.signIn': 'Sign in',
    'auth.signingIn': 'signing in...',
    'auth.create': 'Create account',
    'auth.creating': 'creating account...',
    'auth.switchToRegister': 'No account? Create one',
    'auth.switchToLogin': 'Have an account? Sign in',
    'layout.settings': 'settings',
    'layout.softMode': 'soft mode',
    'layout.createServerPlaceholder': 'Create new server',
    'layout.createServer': 'Create server',
    'layout.inviteCode': 'Invite code',
    'layout.join': 'Join',
    'layout.logout': 'logout',
    'servers.dmTitle': 'Direct messages',
    'channels.directs': 'Directs',
    'channels.searchUsers': 'Search users to DM',
    'channels.channels': 'Channels',
    'channels.newChannel': 'New channel name',
    'channels.loading': 'loading...',
    'channels.noResults': 'no results',
    'channels.searchError': 'search failed',
    'channels.minChars': 'type at least 2 characters',
    'chat.searchPlaceholder': 'Search in messages',
    'chat.find': 'Find',
    'chat.joinVoice': 'Join voice',
    'chat.leaveVoice': 'Leave voice',
    'chat.micOn': 'Mic on',
    'chat.micOff': 'Mic off',
    'chat.deafenOn': 'Deafen',
    'chat.deafenOff': 'Undeafen',
    'chat.results': 'Results: {{count}}',
    'chat.pickDirect': 'Pick a direct thread to start chatting.',
    'chat.pickChannel': 'Pick a channel to start chatting.',
    'chat.noMessages': 'No messages yet.',
    'chat.someoneTyping': 'Someone is typing...',
    'chat.multipleTyping': 'Multiple people are typing...',
    'chat.isTyping': '{{name}} is typing...',
    'chat.directTitle': 'Direct',
    'chat.pickChannelTitle': 'Pick a channel',
    'chat.writeMessage': 'Write a message',
    'chat.file': 'file',
    'chat.send': 'Send',
    'chat.enterHint': 'Enter to send, Shift+Enter for newline.',
    'chat.reactionPrompt': 'Reaction emoji (like ":)" or "<3")',
    'chat.editPrompt': 'Edit message',
    'chat.react': '+react',
    'chat.edit': 'edit',
    'chat.delete': 'delete',
    'members.title': 'Members',
    'members.directInfoTitle': 'Direct info',
    'members.directInfoEmpty': 'Pick a DM to see participants.',
    'settings.title': 'Server Settings',
    'settings.appTitle': 'App Settings',
    'settings.appearance': 'Appearance',
    'settings.theme': 'Theme',
    'settings.language': 'Language',
    'settings.voice': 'Voice & Audio',
    'settings.inputDevice': 'Microphone',
    'settings.outputDevice': 'Output',
    'settings.requestMic': 'Grant mic access',
    'settings.permissionHint': 'Grant mic access to reveal device names.',
    'settings.micStatus': 'Mic status',
    'settings.micMuted': 'muted',
    'settings.micLive': 'live',
    'settings.deafenStatus': 'Listening',
    'settings.deafenOn': 'off',
    'settings.deafenOff': 'on',
    'settings.mute': 'Mute',
    'settings.unmute': 'Unmute',
    'settings.deafen': 'Deafen',
    'settings.undeafen': 'Undeafen',
    'settings.defaultDevice': 'Default',
    'settings.noDevices': 'No devices',
    'settings.close': 'close',
    'settings.renameTitle': 'Rename server',
    'settings.serverName': 'Server name',
    'settings.saveName': 'Save name',
    'settings.danger': 'Danger zone',
    'settings.deleteServer': 'Delete server',
    'settings.invites': 'Invites',
    'settings.inviteMax': 'Max uses (optional)',
    'settings.inviteExpires': 'Expires at (YYYY-MM-DD)',
    'settings.createInvite': 'Create invite',
    'settings.members': 'Members',
    'settings.kick': 'kick',
    'settings.ban': 'ban',
    'settings.revoke': 'revoke',
    'settings.deleteConfirm': 'Delete this server? This cannot be undone.',
    'settings.inviteAlert': 'Invite code: {{code}}',
    'settings.unlimited': 'unlimited',
    'theme.midnight': 'Midnight',
    'theme.dawn': 'Dawn',
    'theme.pulse': 'Pulse',
  },
  ru: {
    'app.name': 'BusyaChat',
    'badge.login': 'входим мягко',
    'badge.register': 'регистрируемся мягко',
    'auth.email': 'почта',
    'auth.password': 'пароль',
    'auth.passwordHint': 'пароль (8+)',
    'auth.username': 'ник',
    'auth.signIn': 'Войти',
    'auth.signingIn': 'входим...',
    'auth.create': 'Создать аккаунт',
    'auth.creating': 'создаём аккаунт...',
    'auth.switchToRegister': 'Нет аккаунта? Создать',
    'auth.switchToLogin': 'Уже есть аккаунт? Войти',
    'layout.settings': 'настройки',
    'layout.softMode': 'мягкий режим',
    'layout.createServerPlaceholder': 'Создать сервер',
    'layout.createServer': 'Создать сервер',
    'layout.inviteCode': 'Код инвайта',
    'layout.join': 'Войти',
    'layout.logout': 'выйти',
    'servers.dmTitle': 'Личные сообщения',
    'channels.directs': 'Личные',
    'channels.searchUsers': 'Найти пользователя для ЛС',
    'channels.channels': 'Каналы',
    'channels.newChannel': 'Имя канала',
    'channels.loading': 'загрузка...',
    'channels.noResults': 'ничего не найдено',
    'channels.searchError': 'ошибка поиска',
    'channels.minChars': 'введите минимум 2 символа',
    'chat.searchPlaceholder': 'Поиск по сообщениям',
    'chat.find': 'Найти',
    'chat.joinVoice': 'Войти в голос',
    'chat.leaveVoice': 'Выйти из голоса',
    'chat.micOn': 'Микрофон: вкл',
    'chat.micOff': 'Микрофон: выкл',
    'chat.deafenOn': 'Глухой режим',
    'chat.deafenOff': 'Снять глухой',
    'chat.results': 'Результатов: {{count}}',
    'chat.pickDirect': 'Выбери диалог, чтобы начать.',
    'chat.pickChannel': 'Выбери канал, чтобы начать.',
    'chat.noMessages': 'Сообщений пока нет.',
    'chat.someoneTyping': 'Кто-то печатает...',
    'chat.multipleTyping': 'Несколько человек печатают...',
    'chat.isTyping': '{{name}} печатает...',
    'chat.directTitle': 'Личные',
    'chat.pickChannelTitle': 'Выбери канал',
    'chat.writeMessage': 'Написать сообщение',
    'chat.file': 'файл',
    'chat.send': 'Отправить',
    'chat.enterHint': 'Enter — отправить, Shift+Enter — новая строка.',
    'chat.reactionPrompt': 'Эмодзи реакции (например ":)" или "<3")',
    'chat.editPrompt': 'Редактировать сообщение',
    'chat.react': '+реакт',
    'chat.edit': 'редактировать',
    'chat.delete': 'удалить',
    'members.title': 'Участники',
    'members.directInfoTitle': 'Инфо',
    'members.directInfoEmpty': 'Выбери диалог, чтобы увидеть участников.',
    'settings.title': 'Настройки сервера',
    'settings.appTitle': 'Настройки приложения',
    'settings.appearance': 'Внешний вид',
    'settings.theme': 'Тема',
    'settings.language': 'Язык',
    'settings.voice': 'Голос и звук',
    'settings.inputDevice': 'Микрофон',
    'settings.outputDevice': 'Вывод',
    'settings.requestMic': 'Разрешить микрофон',
    'settings.permissionHint': 'Разреши микрофон, чтобы увидеть названия устройств.',
    'settings.micStatus': 'Микрофон',
    'settings.micMuted': 'выкл',
    'settings.micLive': 'вкл',
    'settings.deafenStatus': 'Прослушивание',
    'settings.deafenOn': 'выкл',
    'settings.deafenOff': 'вкл',
    'settings.mute': 'Выключить микрофон',
    'settings.unmute': 'Включить микрофон',
    'settings.deafen': 'Глухой режим',
    'settings.undeafen': 'Снять глухой',
    'settings.defaultDevice': 'По умолчанию',
    'settings.noDevices': 'Нет устройств',
    'settings.close': 'закрыть',
    'settings.renameTitle': 'Переименовать сервер',
    'settings.serverName': 'Имя сервера',
    'settings.saveName': 'Сохранить',
    'settings.danger': 'Опасная зона',
    'settings.deleteServer': 'Удалить сервер',
    'settings.invites': 'Инвайты',
    'settings.inviteMax': 'Макс. использований',
    'settings.inviteExpires': 'Истекает (ГГГГ-ММ-ДД)',
    'settings.createInvite': 'Создать инвайт',
    'settings.members': 'Участники',
    'settings.kick': 'кик',
    'settings.ban': 'бан',
    'settings.revoke': 'отозвать',
    'settings.deleteConfirm': 'Удалить сервер? Это нельзя отменить.',
    'settings.inviteAlert': 'Код инвайта: {{code}}',
    'settings.unlimited': 'без лимита',
    'theme.midnight': 'Полночь',
    'theme.dawn': 'Рассвет',
    'theme.pulse': 'Импульс',
  },
};

export function getDefaultLocale(): Locale {
  if (typeof navigator === 'undefined') return 'en';
  return navigator.language?.toLowerCase().startsWith('ru') ? 'ru' : 'en';
}

export function t(locale: Locale, key: string, vars?: Record<string, string | number>): string {
  const text = STRINGS[locale]?.[key] ?? STRINGS.en[key] ?? key;
  if (!vars) return text;
  return text.replace(/\{\{(\w+)\}\}/g, (_match, k) => String(vars[k] ?? ''));
}
